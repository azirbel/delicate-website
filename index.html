<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Delicate Website</title>
    <script src="matter.js"></script>
  </head>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
        sans-serif;
    }

    #box {
      position: absolute;
      background: #111;
      color: #eee;
      height: 80px;
      width: 140px;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Amatic SC";
      text-shadow: 2px 2px 3px #38e;
    }

    .world-object {
      cursor: grab;
      user-select: none;
      /* border: 1px solid green; */
    }

    #ground {
      position: absolute;
      background: #666;
      top: 140px;
      height: 120px;
      width: 400px;
    }

    html,
    body {
      position: relative;
      height: 100%;
      margin: 0;
    }
  </style>
  <body>
    <div
      id="engine"
      style="
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      "
    ></div>
    <div style="position: relative; margin: 20px; z-index: 2; color: white">
      <h1 id="header">Hello</h1>
      <p id="world">World</p>
      <div id="box" class="world-object">
        <h1>hello world</h1>
      </div>
      <div id="ground"></div>
    </div>
  </body>
  <script>
    // // module aliases
    // let Engine = Matter.Engine,
    //   Render = Matter.Render,
    //   Runner = Matter.Runner,
    //   Bodies = Matter.Bodies,
    //   Composite = Matter.Composite

    // // create an engine
    // let engine = Engine.create()

    // // create a renderer
    // let render = Render.create({
    //   element: document.getElementById("engine"),
    //   engine: engine,
    //   options: {
    //     width: window.innerWidth,
    //     height: window.innerHeight,
    //   },
    // })

    // // create two boxes and a ground
    // let boxA = Bodies.rectangle(400, 200, 80, 80)
    // let boxB = Bodies.rectangle(450, 50, 80, 80)
    // let ground = Bodies.rectangle(400, 610, 810, 60, { isStatic: true })

    // // add all of the bodies to the world
    // Composite.add(engine.world, [boxA, boxB, ground])

    // // run the renderer
    // Render.run(render)

    // // create runner
    // let runner = Runner.create()

    // // run the engine
    // Runner.run(runner, engine)

    // console.log("eyy")

    // window.addEventListener("resize", function () {
    //   console.log("adjust resize")
    //   render.canvas.width = window.innerWidth
    //   render.canvas.height = window.innerHeight
    // })

    const worldObjects = []

    const engine = Matter.Engine.create()
    const box = {
      w: 140,
      h: 80,
      body: Matter.Bodies.rectangle(150, 0, 140, 80),
      elem: document.querySelector("#box"),
      render() {
        const { x, y } = this.body.position
        this.elem.style.top = `${y - this.h / 2}px`
        this.elem.style.left = `${x - this.w / 2}px`
        this.elem.style.transform = `rotate(${this.body.angle}rad)`
      },
    }
    worldObjects.push(box)
    const ground = Matter.Bodies.rectangle(200, 200, 400, 120, {
      isStatic: true,
    })
    const mouseConstraint = Matter.MouseConstraint.create(engine, {
      element: document.body,
    })

    // Take an input element, and wrap each of its letter in a span
    function decomposeToSpans(el) {
      const innerText = el.innerText
      el.textContent = ""
      return innerText.split("").map((letter) => {
        const span = document.createElement("span")
        span.textContent = letter
        el.appendChild(span)
        return span
      })
    }

    function makeBody(el) {
      const rect = el.getBoundingClientRect()
      const clone = el.cloneNode(true)
      clone.style.position = "absolute"
      clone.style.color = "red"
      clone.style.top = `${rect.top}px`
      clone.style.left = `${rect.left}px`
      clone.style.zIndex = 3
      clone.classList.add("world-object")
      el.style.opacity = 0.5
      el.parentElement.appendChild(clone)

      const worldObject = {
        w: rect.width,
        h: rect.height,
        body: Matter.Bodies.rectangle(
          rect.left,
          rect.top,
          rect.width,
          rect.height
        ),
        elem: clone,
        render() {
          const { x, y } = this.body.position
          this.elem.style.top = `${y - this.h / 2}px`
          this.elem.style.left = `${x - this.w / 2}px`
          this.elem.style.transform = `rotate(${this.body.angle}rad)`
        },
      }

      worldObjects.push(worldObject)
    }

    decomposeToSpans(document.querySelector("#world")).forEach((span) => {
      makeBody(span)
    })

    decomposeToSpans(document.querySelector("#header")).forEach((span) => {
      makeBody(span)
    })

    Matter.Composite.add(engine.world, [
      ...worldObjects.map((o) => o.body),
      ground,
      mouseConstraint,
    ])

    function rerender() {
      worldObjects.forEach((body) => body.render())
      Matter.Engine.update(engine)
      requestAnimationFrame(rerender)
    }

    rerender()
  </script>
</html>
